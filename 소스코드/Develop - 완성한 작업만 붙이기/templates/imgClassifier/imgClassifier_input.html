<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>이름으로 검색하기</title>
        <link rel="icon" type="image/x-icon" href="{{url_for('static', filename='favicon/favicon2.ico')}}" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v5.15.4/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link rel="preconnect" href="https://fonts.gstatic.com" />
        <link href="https://fonts.googleapis.com/css2?family=Tinos:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&amp;display=swap" rel="stylesheet" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="{{url_for('static', filename='css/styles.css')}}" rel="stylesheet" />
        <link href="{{url_for('static', filename='css/imgClassifier.css')}}" rel="stylesheet" />
        <!-- JavaScript -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
        <script src="{{url_for('static', filename='js/script.js')}}" ></script>

        <!-- Loading -->
        <link rel="stylesheet" href="{{url_for('static', filename='css/loading.css')}}"/>
        <script src="http://code.jquery.com/jquery-latest.min.js"></script>
        <script>
            $(document).ready(function() {

            $('#loading').hide();
            $('#imageSearch').submit(function(){
                $('#loading').show();
                return true;
                });
            });
        </script>
    <title>버섯 사진 판별</title>
</head>
<body>
<!-- loading page -->
<div class="loading" id="loading">
    <div class="loadingImg"><img src="/static/images/loadingImage.gif" style="width:100px;height:100px;"></div>
    <h4><span style="color:#FAD496;font-weight:bold">API </span>정보를 로딩 중 입니다...<br><br>
        잠시 기다려주세요.</h4>
</div>
<!-- sidebar -->
{% include './sideMenu/sidebar.html' %}
<!-- Background Video-->
<video class="bg-video" playsinline="playsinline" preload="none" muted="muted" loop="true" autoplay="true">
    <source src="{{url_for('static', filename='mp4/bg2.mp4')}}" type="video/mp4" />
</video>
<!-- imgClassifier_input -->
<div class="masthead">
    <div class="masthead-content text-white">
        <div class="container-fluid px-4 px-lg-0">
            <p class="mb-5">궁금하신 버섯 사진을 검색해보세요.</p>
            <!-- <form name="imageSearch" method="POST" id="imageSearch" action="/mushroom/imageSearch" enctype="multipart/form-data"> -->
            <form name="imageSearch" id="imageSearch"  enctype="multipart/form-data">
                <label class="uploadfileBtn" for="uploadfile" accept=".jpg,.jpeg,.png">업로드 파일</label>
                <input type="file" id="uploadfile" name="uploadfile"/>
                <p id="inputFileName">No File</p>
                <input id="searchBtn" class="searchBtn" type="submit" value="판별하기" disabled/>
            </form>
        </div>
    </div>
</div>
</body>
<!-- Bootstrap core JS-->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.bundle.js"></script>
<!-- Core theme JS-->
<script src="js/scripts.js"></script>
<script type="text/javascript">
// 업로드할 파일 이름 처리하기
const $uploadFile = document.querySelector("#uploadfile");
const $inputFileName = document.querySelector("#inputFileName");
const $formUploadButton = document.querySelector("#searchBtn");

const fileTypes = [
    "image/jpeg",
    "image/png"
]

const validFileType = (file) => {
    return fileTypes.includes(file.type);
}
const returnFileSize = (number) => {
    if(number < 1024) {
        return number + 'bytes';
    } else if(number >= 1024 && number < 1048576) {
        return (number/1024).toFixed(1) + 'KB';
    } else if(number >= 1048576) {
        return (number/1048576).toFixed(1) + 'MB';
    }
}
let uploadReady = new Boolean(false);

const updateImageFile = () => {
    const currentFiles = $uploadFile.files;
    if(currentFiles.length === 0) {
        $inputFileName.textContent = "파일이 업로드 되지 않았습니다.";
    }

    for(const file of currentFiles) {
        if(validFileType(file)) {
            uploadReady = true;
            $inputFileName.textContent = `${file.name}, size: ${returnFileSize(file.size)}`;
            $formUploadButton.removeAttribute("disabled");
        } else {
            $inputFileName.textContent = `${file.name} 은 적합한 파일이 아닙니다.`;
        }
    }
}

$uploadFile.addEventListener("change", updateImageFile);

// 파일 업로드 처리하기
const uploadProcess = () => {
    const $imageSearch = document.querySelector("#imageSearch");
    if(uploadReady == true) {
        $imageSearch.method = "POST";
        $imageSearch.action = "/mushroom/imageSearch";
    }
}

$formUploadButton.addEventListener("click", uploadProcess);


</script>
<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
<!-- * *                               SB Forms JS                               * *-->
<!-- * * Activate your form at https://startbootstrap.com/solution/contact-forms * *-->
<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
<script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>
</html>